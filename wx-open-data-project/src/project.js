window.__require=function e(t,o,n){function a(s,i){if(!o[s]){if(!t[s]){var l=s.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!i&&c)return c(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+s+"'")}}var g=o[s]={exports:{}};t[s][0].call(g.exports,function(e){return a(t[s][1][e]||e)},g,g.exports,e,t,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)a(n[s]);return a}({launch:[function(e,t,o){"use strict";cc._RF.push(t,"e53e6YiUd9FJLf8yIQu1n47","launch"),cc.Class({extends:cc.Component,properties:{content:cc.Node,prefab:cc.Prefab,singleItem:cc.Node,loading:cc.Node},start:function(){var e=this;wx.onMessage(function(t){console.log("onMessage from master"),1===t.messageType?(e.getFriendStorage(),e.getMyUserInfo()):2===t.messageType?e.submitScore(t.keyValue,t.level,t.score,t.unit):3===t.messageType?(e.getGroupFriendData(t.keyValue),console.log("onMessage from master get group")):4===t.messageType?e.removeScore(t.keyValue):5===t.messageType&&e.getCompeStorage(t.openIDList,t.info)})},removeOriginRecore:function(){this.content.removeAllChildren(),this.singleItem.removeAllChildren(),this.loading.active=!0},getMyUserInfo:function(){wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){console.log("wx.getUserInfo success",e.data)},fail:function(e){reject("fail: ",e)}})},getFriendStorage:function(){this.removeOriginRecore();var e=this;console.log("getFriendStorage"),wx.getUserInfo({openIdList:["selfOpenId"],success:function(t){var o=t.data[0];console.log("getUserInfo success userData\uff1a",o),wx.getFriendCloudStorage({keyList:["level","score","unit"],success:function(t){e.loading.active=!1,console.log("getFriendStorage's res is:",t);var o=t.data,n=["","k","m","b","t","aa","bb","cc","dd","ee","ff","gg","hh","ii","jj"];o.sort(function(e,t){if(e.KVDataList.length===t.KVDataList.length){var o=e.KVDataList[0].value,a=t.KVDataList[0].value;if(o!==a)return a-o;var r=void 0===e.KVDataList[2].value?0:n.indexOf(e.KVDataList[2].value),s=void 0===t.KVDataList[2].value?0:n.indexOf(t.KVDataList[2].value);if(console.log("a.KVDataList.unit:",r),console.log("b.KVDataList.unit:",s),r!==s)return s-r;var i=e.KVDataList[1].value;return t.KVDataList[1].value-i}console.log("a.KVDataList.length != b.KVDataList.length")}),console.log("data:",o);for(var a=0;a<o.length;a++){var r=o[a];console.log("\u6dfb\u52a0\u4e2a\u4eba\u6570\u636e"),e.showUserData(a,r.openId,r.nickname,r.avatarUrl,r.KVDataList,null,!1)}},fail:function(e){console.log(e)}})},fail:function(){console.log("getUserInfo fail")}})},preSettingData:function(e,t,o,n){if(!t)return console.log("preSettingData",o),!1;var a=t.nickname;return n&&(a=t.nickName),this.showUserData(e,t.openId,a,t.avatarUrl,t.KVDataList,n),!0},preSettingWorldData:function(e,t,o){return this.showUserData(e,t),!0},showUserData:function(e,t,o,n,a,r){!(arguments.length>6&&void 0!==arguments[6])||arguments[6];var s=cc.instantiate(this.prefab);s.parent=this.content;var i=s.getChildByName("userName").getComponent(cc.Label),l=s.getChildByName("mask").children[0].getComponent(cc.Sprite),c=s.getChildByName("score").getComponent(cc.Label),g=s.getChildByName("level").getComponent(cc.Label),u=s.getChildByName("rankNode").getChildByName("rankingIcon"),f=u.getChildByName("normal"),d=f.getChildByName("rankingLabel");switch(f.active=!1,c.string=a[1].value+a[2].value,g.string=a[0].value,e){case 0:u.active=!0,u.getChildByName("gold").active=!0;break;case 1:u.active=!0,u.getChildByName("silver").active=!0;break;case 2:u.active=!0,u.getChildByName("copper").active=!0}e>2&&(f.active=!0,d.getComponent(cc.Label).string=e+1);i.string=o,cc.loader.load({url:n,type:"png"},function(e,t){e&&console.error(e),console.log(t),l.spriteFrame=new cc.SpriteFrame(t)})},removeScore:function(e){wx.removeUserCloudStorage({keyList:[e]})},submitScore:function(e,t,o,n){console.log("this is submitScore"),wx.getUserCloudStorage({keyList:[e],success:function(e){console.log("getUserCloudStorage","level",t),console.log("getUserCloudStorage","score",o),console.log("getUserCloudStorage","unit",n),console.log("getUserCloudStorage","success",e),wx.setUserCloudStorage({KVDataList:[{key:"level",value:""+t},{key:"score",value:""+o},{key:"unit",value:""+n}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","complete")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},getGroupFriendData:function(e,t){console.log("getGroupFriendData running"),this.removeOriginRecore();wx.getUserInfo({openIdList:["selfOpenId"],success:function(o){console.log("getUserInfo success",o.data);var n=o.data[0];console.log("getUserInfo userData",n),wx.getGroupCloudStorage({shareTicket:t,keyList:[e]})},fail:function(e){console.log("\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22")}})},getCompeStorage:function(e,t){this.removeOriginRecore();var o=this;wx.getUserInfo({openIdList:e,success:function(e){var n=e.data;o.loading.active=!1;for(var a=0;a<t.length;a++)for(var r=t[a],s=0;s<n.length;s++){var i=n[s];if(r.openId===i.openId&&!o.preSettingData(a,i," stop getting friends' infos",r))return}},fail:function(){console.log("getUserInfo fail")}})}}),cc._RF.pop()},{}]},{},["launch"]);